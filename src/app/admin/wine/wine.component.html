<br>
<br>
<!-- Wine --------------------------------------------------------------------------------------------------------------------->

<!-- Wine Table -->
<div class="row align-items-center mb-3">
  <div class="col-md-6">
    <h2>Wine</h2>
  </div>
  <div class="col-md-6 text-end">
    <button class="btn btn-success btn-sm" (click)="openAddWineModal()">
      <i class="fas fa-plus"></i> Add
    </button>
  </div>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <!-- <th scope="col">ID</th> -->
      <th scope="col">Image</th>
      <th scope="col">Name</th>
      <th scope="col">Description</th>
      <th scope="col">Vintage</th>
      <th scope="col">Varietal</th>
      <th scope="col">Type</th>
      <th scope="col">Restock Limit</th>
      <th scope="col">Price (ZAR)</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let wine of wines">
      <td><img [src]="wine.imageUrl" alt="Wine image" class="wine-image"></td>
      <td>{{ wine.name }}</td>
      <td>{{ wine.description }}</td>
      <td>{{ wine.vintage }}</td>
      <td>{{ getVarietalName(wine.varietalID) }}</td> <!-- Added Varietal data -->
      <td>{{ getWinetypeName(wine.wineTypeID) }}</td> <!-- Added Type data -->
      <td>{{ wine.restockLimit }}</td>
      <td>{{ wine.winePrice }}</td>
      <td>
        <button class="btn btn-primary" (click)="wine.wineID !== undefined && openEditWineModal(wine.wineID)"
          style="margin-right: 4px;">
          <i class="fas fa-pencil-alt"></i>
        </button>
        <button class="btn btn-danger" (click)="wine.wineID !== undefined && openDeleteWineModal(wine)">
          <i class="fas fa-trash-alt"></i>
        </button>
      </td>
    </tr>
  </tbody>
</table>

<div class="text-center" *ngIf="wines.length === 0">
  <h3>No wines currently in your system.</h3>
</div>




<!-- Add/Edit Wine Modal -->
<div class="modal" tabindex="-1" [ngClass]="{'show': showWineModal}"
  [ngStyle]="{'display': showWineModal ? 'block' : 'none'}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{editingWine ? 'Edit Wine' : 'Add Wine'}}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeWineModal()"></button>
      </div>
      <div class="modal-body">
        <form #wineForm="ngForm" (ngSubmit)="submitWineForm(wineForm)">
          <div class="mb-3">
            <label for="wineName" class="form-label">Wine Name</label>
            <input type="text" class="form-control" id="wineName" [(ngModel)]="currentWine.name" name="wineName"
              required #wineNameField="ngModel">
            <div *ngIf="wineNameField.invalid && wineNameField.touched" class="alert alert-danger">
              <div *ngIf="wineNameField.errors?.['required']">Wine name is required.</div>
            </div>
          </div>          

          <div class="mb-3">
            <label for="wineDescription" class="form-label">Wine Description</label>
            <input type="text" class="form-control" id="wineDescription" [(ngModel)]="currentWine.description"
              name="wineDescription" required #wineDescriptionField="ngModel">
            <div *ngIf="wineDescriptionField.invalid && wineDescriptionField.touched" class="alert alert-danger">
              <div *ngIf="wineDescriptionField.errors?.['required']">Wine description is required.</div>
            </div>
          </div>
          
          <div class="mb-3">
            <label for="wineVintage" class="form-label">Wine Vintage</label>
            <input type="text" class="form-control" id="wineVintage" [(ngModel)]="currentWine.vintage"
              name="wineVintage" required #wineVintageField="ngModel">
            <div *ngIf="wineVintageField.invalid && wineVintageField.touched" class="alert alert-danger">
              <div *ngIf="wineVintageField.errors?.['required']">Wine vintage is required.</div>
            </div>
          </div>

          <div class="mb-3">
            <label for="wineRestockLimit" class="form-label">Restock Limit</label>
            <input type="number" class="form-control" id="wineRestockLimit" [(ngModel)]="currentWine.restockLimit"
              name="wineRestockLimit" required [min]="0.01" #wineRestockLimitField="ngModel">
            <div *ngIf="wineRestockLimitField.invalid && wineRestockLimitField.touched" class="alert alert-danger">
              <div *ngIf="wineRestockLimitField.errors?.['required']">Restock limit is required.</div>
              <div *ngIf="wineRestockLimitField.errors?.['min']">Restock limit cannot be zero.</div>
            </div>
          </div>
          
          

          <div class="mb-3">
            <label for="wineTastingNote" class="form-label">Wine Tasting Note</label>
            <input type="text" class="form-control" id="wineTastingNote" [(ngModel)]="currentWine.wineTastingNote"
              name="wineTastingNote" required #wineTastingNoteField="ngModel">
            <div *ngIf="wineTastingNoteField.invalid && wineTastingNoteField.touched" class="alert alert-danger">
              <div *ngIf="wineTastingNoteField.errors?.['required']">Wine tasting note is required.</div>
            </div>
          </div>
          

     <div class="mb-3">
  <label for="winePrice" class="form-label">Wine Price</label>
  <input type="number" class="form-control" id="winePrice" [(ngModel)]="currentWine.winePrice"
    name="winePrice" required [min]="0.01" #winePriceField="ngModel">
  <div *ngIf="winePriceField.invalid && winePriceField.touched" class="alert alert-danger">
    <div *ngIf="winePriceField.errors?.['required']">Wine price is required.</div>
    <div *ngIf="winePriceField.errors?.['min']">Wine price cannot be zero.</div>
  </div>
</div>

          

          <div class="mb-3">
            <label for="wineType" class="form-label">Wine Type</label>
            <select class="form-control" id="wineType" [(ngModel)]="currentWine.wineTypeID" name="wineType" required #wineTypeField="ngModel">
              <option *ngFor="let winetype of winetypes" [value]="winetype.wineTypeID">{{winetype.name}}</option>
            </select>
            <div *ngIf="wineTypeField.invalid && wineTypeField.touched" class="alert alert-danger">
              <div *ngIf="wineTypeField.errors?.['required']">Wine type is required.</div>
            </div>
          </div>
          

          <div class="mb-3">
            <label for="wineVarietal" class="form-label">Wine Varietal</label>
            <select class="form-control" id="wineVarietal" [(ngModel)]="currentWine.varietalID" name="wineVarietal"
              required #wineVarietalField="ngModel">
              <option *ngFor="let varietal of varietals" [value]="varietal.varietalID">{{varietal.name}}</option>
            </select>
            <div *ngIf="wineVarietalField.invalid && wineVarietalField.touched" class="alert alert-danger">
              <div *ngIf="wineVarietalField.errors?.['required']">Wine varietal is required.</div>
            </div>
          </div>
          

          <div class="mb-3">
            <label for="imageUrl" class="form-label">Image</label>
            <input type="file" class="form-control" id="imageUrl" (change)="onFileSelected($event)" name="imageUrl" accept="image/*" required>
          </div>
          

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeWineModal()">Close</button>
        <button type="button" class="btn btn-primary" (click)="submitWineForm(wineForm)">{{editingWine ?
          'Save Changes' : 'Save'}}</button>
      </div>
    </div>
  </div>
</div>



<!-- Delete Wine modal -->
<div class="modal" tabindex="-1" [ngClass]="{'show': showDeleteWineModal}"
  [ngStyle]="{'display': showDeleteWineModal ? 'block' : 'none'}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Confirmation</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeDeleteWineModal()"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this wine?
        <p>Wine Name: {{ wineToDeleteDetails?.name }}</p>
        <p>Wine Description: {{ wineToDeleteDetails?.description }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteWineModal()">No</button>
        <button type="button" class="btn btn-primary" (click)="deleteWine()">Yes</button>
      </div>
    </div>
  </div>
</div>

<!-- Wine END --------------------------------------------------------------------------------------------------------------------->
<!-- Discount ------------------------------------------------------------------------------------------------------------------------------------------------------------>
<!-- Discount button -->
<div class="row align-items-center mb-3">
  <div class="col-md-6">
    <h2>Discount</h2>
  </div>
  <div class="col-md-6 text-end">
    <button class="btn btn-success btn-sm" (click)="openAddDiscountModal()">
      <i class="fas fa-plus"></i> Add
    </button>
  </div>
</div>


<!--Discount table -->
<table class="table table-striped">

  <thead>
    <tr>
      <th scope="col">Code</th>
      <th scope="col">Description</th>
      <th scope="col">Percentage %</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let discount of discounts">
      <td>{{ discount.discountCode }}</td>
      <td>{{ discount.discountDescription }}</td>
      <td>{{ discount.discountPercentage }}</td>
      <td>
        <button class="btn btn-primary"
          (click)="discount.discountID !== undefined && openEditDiscountModal(discount.discountID)"
          style="margin-right: 4px;">
          <i class="fas fa-pencil-alt"></i>
        </button>

        <button class="btn btn-danger" (click)="discount.discountID !== undefined && openDeleteDiscountModal(discount)">
          <i class="fas fa-trash-alt"></i>
        </button>


      </td>
    </tr>
  </tbody>
</table>

<div class="text-center" *ngIf="discounts.length === 0">
  <h3>No discounts currently in your system.</h3>
</div>


<!-- Add/Edit Discount Modal -->
<div class="modal" tabindex="-1" [ngClass]="{'show': showDiscountModal}" [ngStyle]="{'display': showDiscountModal ? 'block' : 'none'}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{editingDiscount ? 'Edit Discount' : 'Add Discount'}}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeDiscountModal()"></button>
      </div>
      <div class="modal-body">
        <form #discountForm="ngForm" (ngSubmit)="submitDiscountForm(discountForm)">

          <div class="mb-3">
            <label for="discountCode" class="form-label">Discount Code</label>
            <input type="text" class="form-control" id="discountCode" [(ngModel)]="currentDiscount.discountCode"
              name="discountCode" required disabled>
          </div>

          <div class="mb-3">
            <label for="discountDescription" class="form-label">Discount Description</label>
            <input type="text" class="form-control" id="discountDescription"
              [(ngModel)]="currentDiscount.discountDescription" name="discountDescription" required #discountDescriptionField="ngModel">
            <div *ngIf="discountDescriptionField.invalid && discountDescriptionField.touched" class="alert alert-danger">
              <div *ngIf="discountDescriptionField.errors?.['required']">Discount description is required.</div>
            </div>
          </div>

          <div class="mb-3">
            <label for="discountAmount" class="form-label">Discount Percentage Amount</label>
            <input type="number" class="form-control" id="discountAmount" [(ngModel)]="currentDiscount.discountPercentage"
              name="discountAmount" required [min]="0.01" [max]="100" #discountAmountField="ngModel">
            <div *ngIf="discountAmountField.invalid && discountAmountField.touched" class="alert alert-danger">
              <div *ngIf="discountAmountField.errors?.['required']">Discount amount is required.</div>
              <div *ngIf="discountAmountField.errors?.['min']">Discount amount cannot be zero.</div>
              <div *ngIf="discountAmountField.errors?.['max']">Discount amount cannot be more than 100.</div>
            </div>
          </div>
          

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDiscountModal()">Close</button>
        <button type="button" class="btn btn-primary" [disabled]="discountForm.invalid" (click)="submitDiscountForm(discountForm)">
          {{editingDiscount ? 'Save Changes' : 'Save'}}
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Delete discount modal -->
<div class="modal" tabindex="-1" [ngClass]="{'show': showDeleteDiscountModal}"
  [ngStyle]="{'display': showDeleteDiscountModal ? 'block' : 'none'}">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Confirmation</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this discount?
        <p>Discount Code: {{ discountToDeleteDetails?.discountCode }}</p>
        <p>Discount Description: {{ discountToDeleteDetails?.discountDescription }}</p>
        <p>Discount Percentage Amount: {{ discountToDeleteDetails?.discountAmount }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">No</button>
        <button type="button" class="btn btn-primary" (click)="deleteDiscount()">Yes</button>
      </div>
    </div>
  </div>
</div>


<!-- Discount ---------------------------------------------------------------------------------------------------------------------------------------------------------->