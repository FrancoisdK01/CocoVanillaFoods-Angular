<br>
<br>

<div class="row align-items-center mb-3">
    <div class="col-md-6">
        <h2>Supplier Orders</h2>
    </div>
    <div class="col-md-6 text-end">
        <button class="btn btn-success" (click)="openAddSupplierOrderModal()">
            <i class="fas fa-plus"></i> Add
        </button>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">Wine Name</th>
                <th scope="col">Quantity Ordered</th>
                <th scope="col">Order Price</th>
                <th scope="col">Date Ordered</th>
                <th scope="col">Supplier Name</th>
                <th scope="col">Ordered</th>
                <th scope="col">Paid</th>
                <th scope="col">Received</th>
            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let order of supplierOrders; let i = index">
                <td>{{ order.wineName }}</td>
                <td>{{ order.quantity_Ordered }}</td>
                <td>{{ order.orderTotal }}</td>
                <td>{{ order.dateOrdered }}</td>
                <td>{{ order.supplier?.name }}</td>

                <!-- Ordered -->
                <td>
                    <input *ngIf="order.supplierOrderStatus" type="checkbox"
                        [(ngModel)]="order.supplierOrderStatus.ordered" (change)="updateOrder(order); AddAuditLog('Supplier Order Update Status Ordered')">
                </td>

                <!-- Paid -->
                <td>
                    <input *ngIf="order.supplierOrderStatus" type="checkbox"
                        [(ngModel)]="order.supplierOrderStatus.paid" [disabled]="!order.supplierOrderStatus.ordered"
                        (change)="updateOrder(order); AddAuditLog('Supplier Order Update Status Paid')">
                </td>

                <!-- Received -->
                <td>
                    <input *ngIf="order.supplierOrderStatus" type="checkbox"
                        [(ngModel)]="order.supplierOrderStatus.received"
                        [disabled]="!order.supplierOrderStatus.ordered || !order.supplierOrderStatus.paid"
                        (change)="updateOrder(order); AddAuditLog('Supplier Order Update Status Received')">
                </td>
                <!-- Add this to your <tr> element -->
                <!-- <td> Mens moet nie supplier orders kan delete nie agv audit trail of iets ek kan nie onthou nie maar Prof het so gese.
                    <button class="btn btn-danger"
                        *ngIf="order.supplierOrderStatus?.ordered && order.supplierOrderStatus?.paid && order.supplierOrderStatus?.received"
                        (click)="order.supplierOrderID !== undefined && openDeleteSupplierOrderModal(order)">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td> -->

            </tr>
        </tbody>




    </table>
</div>
<!-- Debug: Display raw data -->
<!-- <pre>{{ supplierOrders | json }}</pre> -->

<div class="text-center" *ngIf="supplierOrders.length === 0">
    <h3>No supplier orders currently in your system.</h3>
</div>

<!-- Add Supplier Order Modal -->
<div class="modal" tabindex="-1" [ngClass]="{'show': showAddSupplierOrderModal}"
    [ngStyle]="{'display': showAddSupplierOrderModal ? 'block' : 'none'}">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Supplier Order</h5>
                <button type="button" class="btn-close" aria-label="Close"
                    (click)="closeAddSupplierOrderModal()"></button>
            </div>
            <div class="modal-body">
                <form #addSupplierOrderForm="ngForm" (ngSubmit)="createOrder(addSupplierOrderForm.value)">
                    <!-- In your Add Supplier Order Modal form -->
                    <div class="mb-3">
                        <label for="wineName" class="form-label">Wine Name</label>
                        <i class="fa fa-question-circle" data-bs-toggle="tooltip" title="Please enter the Wine Name"></i>
                        <input *ngIf="selectedOrder" type="text" class="form-control" id="wineName" name="wineName"
                            [(ngModel)]="selectedOrder.wineName" required>
                    </div>
                    <div class="mb-3">
                        <label for="wineYear" class="form-label">Wine Year</label>
                        <i class="fa fa-question-circle" data-bs-toggle="tooltip" title="Please enter the Wine Year"></i>
                        <input *ngIf="selectedOrder" type="text" class="form-control" id="wineYear" name="wineYear"
                            [(ngModel)]="selectedOrder.wineYear" required>
                    </div>
                    <div class="mb-3">
                        <label for="wineType" class="form-label">Wine Type</label>
                        <i class="fa fa-question-circle" data-bs-toggle="tooltip" title="Please enter the Wine type"></i>
                        <input *ngIf="selectedOrder" type="text" class="form-control" id="wineType" name="wineType"
                            [(ngModel)]="selectedOrder.wineType" required>
                    </div>
                    <div class="mb-3">
                        <label for="winePrice" class="form-label">Wine Price</label>
                        <i class="fa fa-question-circle" data-bs-toggle="tooltip" title="Please enter the Wine price"></i>
                        <input *ngIf="selectedOrder" type="number" class="form-control" id="winePrice" name="winePrice"
                            [(ngModel)]="selectedOrder.winePrice" min="1" required>
                    </div>

                    <div class="mb-3">
                        <label for="quantityOrdered" class="form-label">Quantity Ordered</label>
                        <i class="fa fa-question-circle" data-bs-toggle="tooltip" title="Please enter the quantity ordered"></i>
                        <input *ngIf="selectedOrder" type="number" class="form-control" id="quantityOrdered"
                            name="quantity_Ordered" [(ngModel)]="selectedOrder.quantity_Ordered" min="1" required>
                    </div>

                    <div *ngIf="selectedOrder">
                        <label for="quantityOrdered" class="form-label">Supplier</label>
                        <i class="fa fa-question-circle" data-bs-toggle="tooltip" title="Please select the supplier ordered from"></i>
                        <select id="supplierID" name="supplierID" [(ngModel)]="selectedOrder.supplierID"
                            class="form-control">
                            <option *ngFor="let supplier of suppliers" [value]="supplier.supplierID">{{supplier.name}}
                            </option>
                        </select>
                    </div>


                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeAddSupplierOrderModal()">Close</button>
                <button type="button" class="btn btn-primary" [disabled]="addSupplierOrderForm.invalid"
                    (click)="createOrder(addSupplierOrderForm.value); AddAuditLog('Supplier Order Added')">Add</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Supplier Order Modal -->
<div class="modal" tabindex="-1" [ngClass]="{'show': showDeleteSupplierOrderModal}"
    [ngStyle]="{'display': showDeleteSupplierOrderModal ? 'block' : 'none'}">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Confirmation</h5>
                <button type="button" class="btn-close" aria-label="Close"
                    (click)="closeDeleteSupplierOrderModal()"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this supplier order?
                <!-- <br>
                <p></p>
                <p>Order ID: {{ supplierOrderToDelete?.supplierOrderID }}</p>
                <p>Quantity Ordered: {{ supplierOrderToDelete?.quantity_Ordered }}</p>
                <p>Supplier ID: {{ supplierOrderToDelete?.supplierID }}</p> -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeDeleteSupplierOrderModal()">No</button>
                <button type="button" class="btn btn-primary" (click)="deleteOrder()">Yes</button>
            </div>
        </div>
    </div>
</div>